<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, init        .goblin-specialty {
            font-size: 14px;
            color: #81ecec;
            margin-bottom: 5px;
        }
        
        /* AI ì±„íŒ… ì‹œìŠ¤í…œ */
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 300px;
            background: rgba(46, 90, 53, 0.95);
            border: 2px solid #4ecdc4;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            z-index: 1002;
            display: none;
            flex-direction: column;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            padding: 15px;
            border-radius: 13px 13px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 25px;
            height: 25px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            max-height: 200px;
        }
        
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .user-message {
            background: #00b894;
            color: white;
            margin-left: auto;
        }
        
        .ai-message {
            background: rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
            border: 1px solid #4ecdc4;
        }
        
        .chat-input-container {
            padding: 15px;
            border-top: 1px solid #4ecdc4;
        }
        
        .chat-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            background: rgba(78, 205, 196, 0.1);
            color: white;
            font-size: 14px;
        }
        
        .chat-input::placeholder {
            color: #81ecec;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #00cec9;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }cale=1.0">
    <title>ğŸŒ² ë§ˆë²•ì˜ ìˆ² - ë„ê¹¨ë¹„ ë©”íƒ€ë²„ìŠ¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c28 0%, #2d5a35 100%);
            color: white;
            overflow: hidden;
        }
        
        #forest-canvas {
            display: block;
            width: 100vw;
            height: 100vh;
            cursor: crosshair;
        }
        
        /* ë©”ì¸ UI ì»¨í…Œì´ë„ˆ */
        .ui-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            pointer-events: none;
        }
        
        .ui-container > * {
            pointer-events: auto;
        }
        
        /* ìƒíƒœ í‘œì‹œ */
        .status-display {
            background: rgba(46, 90, 53, 0.9);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 14px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            background: rgba(46, 90, 53, 0.95);
            border: 2px solid #4ecdc4;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            min-width: 300px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 12px 16px;
            margin: 5px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }
        
        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
        .back-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            border: none;
            border-radius: 10px;
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        /* ìˆ² ë„ê¹¨ë¹„ ì¹´ë“œ */
        .forest-goblin-card {
            background: rgba(34, 60, 40, 0.9);
            border: 2px solid #4ecdc4;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .forest-goblin-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.3);
            border-color: #7fdfdb;
        }
        
        .goblin-name {
            font-size: 18px;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 8px;
        }
        
        .goblin-specialty {
            font-size: 14px;
            color: #a8e6cf;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <button class="back-btn" onclick="goBackToVillage()">â† ğŸ˜ï¸ ë„ê¹¨ë¹„ ë§ˆì„ë¡œ</button>
    
    <!-- ë©”ì¸ ìº”ë²„ìŠ¤ -->
    <canvas id="forest-canvas"></canvas>
    
    <!-- UI ì»¨í…Œì´ë„ˆ -->
    <div class="ui-container">
        <!-- ìƒíƒœ í‘œì‹œ -->
        <div class="status-display" id="statusDisplay">
            ğŸŒ² ë§ˆë²•ì˜ ìˆ²ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!
        </div>
        
        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="control-panel">
            <h2 style="color: #4ecdc4; margin-bottom: 15px; text-align: center;">ğŸŒ² ë§ˆë²•ì˜ ìˆ²</h2>
            
            <div style="margin-bottom: 20px;">
                <h3 style="color: #4ecdc4; margin-bottom: 10px; font-size: 16px;">ğŸ® ì»¨íŠ¸ë¡¤</h3>
                <button class="control-btn" onclick="toggleAvatar()">ğŸš¶â€â™€ï¸ ì•„ë°”íƒ€ ì†Œí™˜</button>
                <button class="control-btn" onclick="resetCamera()">ğŸ“· ì¹´ë©”ë¼ ë¦¬ì…‹</button>
                <button class="control-btn" onclick="toggleWeather()">ğŸŒ§ï¸ ë‚ ì”¨ ë³€ê²½</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h3 style="color: #4ecdc4; margin-bottom: 10px; font-size: 16px;">ğŸ§šâ€â™€ï¸ ìˆ²ì˜ ë„ê¹¨ë¹„ë“¤</h3>
                <div id="forestGoblinGrid">
                    <!-- ìˆ² ë„ê¹¨ë¹„ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI ì±„íŒ… ì‹œìŠ¤í…œ -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <span id="chatTitle">ğŸŒ¿ ìˆ²ì§€ê¸°ì™€ ëŒ€í™”</span>
            <button class="chat-close" onclick="closeChat()">Ã—</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="ìˆ²ì˜ ë„ê¹¨ë¹„ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì„¸ìš”..." onkeypress="handleChatKeyPress(event)">
        </div>
    </div>
    
    <!-- Three.js ë° GSAP ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <script>
        // ğŸŒ² ë§ˆë²•ì˜ ìˆ² ì „ì—­ ë³€ìˆ˜
        let scene, camera, renderer, controls;
        let avatar = null;
        let isSystemReady = false;
        
        // ğŸ§šâ€â™€ï¸ ìˆ²ì˜ íŠ¹ë³„í•œ ë„ê¹¨ë¹„ë“¤
        const forestGoblins = [
            { name: 'ğŸŒ¿ ìˆ²ì§€ê¸°', specialty: 'ìì—° ë§ˆë²•', description: 'ìˆ²ì˜ ëª¨ë“  ìƒëª…ì„ ëŒë³´ëŠ” ì§€í˜œë¡œìš´ ë„ê¹¨ë¹„', emoji: 'ğŸŒ¿', color: 0x228B22 },
            { name: 'ğŸ¦‹ ë‚˜ë¹„ìˆ ì‚¬', specialty: 'ë³€í™” ë§ˆë²•', description: 'ì•„ë¦„ë‹¤ìš´ ë³€í™”ì™€ ì„±ì¥ì„ ì´ë„ëŠ” ë„ê¹¨ë¹„', emoji: 'ğŸ¦‹', color: 0xFF69B4 },
            { name: 'ğŸŒ™ ë‹¬ë¹›ë¬´ë‹¹', specialty: 'ì¹˜ìœ  ë§ˆë²•', description: 'ë‹¬ë¹›ì˜ í˜ìœ¼ë¡œ ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ëŠ” ë„ê¹¨ë¹„', emoji: 'ğŸŒ™', color: 0x9370DB },
            { name: 'ğŸŒº ê½ƒë§ìŸì´', specialty: 'ì†Œí†µ ë§ˆë²•', description: 'ì‹ë¬¼ë“¤ê³¼ ëŒ€í™”í•˜ë©° ë¹„ë°€ì„ ì „í•˜ëŠ” ë„ê¹¨ë¹„', emoji: 'ğŸŒº', color: 0xFF1493 },
            { name: 'ğŸ¦‰ ì§€í˜œë¶€ì—‰ì´', specialty: 'ì˜ˆì–¸ ë§ˆë²•', description: 'ë¯¸ë˜ë¥¼ ë‚´ë‹¤ë³´ëŠ” ì‹ ë¹„ë¡œìš´ ë„ê¹¨ë¹„', emoji: 'ğŸ¦‰', color: 0x8B4513 },
            { name: 'ğŸ„ ë²„ì„¯ìš”ë¦¬ì‚¬', specialty: 'ì—°ê¸ˆìˆ ', description: 'ë§ˆë²• ë²„ì„¯ìœ¼ë¡œ ì‹ ë¹„í•œ ìš”ë¦¬ë¥¼ ë§Œë“œëŠ” ë„ê¹¨ë¹„', emoji: 'ğŸ„', color: 0xDC143C }
        ];
        
        // ğŸ¯ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus(message) {
            const statusElement = document.getElementById('statusDisplay');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }
        
        // ğŸ”™ ë„ê¹¨ë¹„ ë§ˆì„ë¡œ ëŒì•„ê°€ê¸°
        function goBackToVillage() {
            updateStatus('ğŸ˜ï¸ ë„ê¹¨ë¹„ ë§ˆì„ë¡œ ëŒì•„ê°€ëŠ” ì¤‘...');
            // GitHub Pagesìš© ë² ì´ìŠ¤ URL ê³„ì‚°
            const baseURL = window.location.origin + window.location.pathname.replace(/\/[^\/]*$/, '/');
            setTimeout(() => {
                window.location.href = baseURL + 'index.html';
            }, 1000);
        }
        
        // ğŸ® ì•„ë°”íƒ€ í† ê¸€
        function toggleAvatar() {
            if (!avatar) {
                createAvatar();
            } else {
                removeAvatar();
            }
        }
        
        // ğŸš¶â€â™€ï¸ ì•„ë°”íƒ€ ìƒì„±
        function createAvatar() {
            // ì•„ë°”íƒ€ ê·¸ë£¹ ìƒì„±
            avatar = new THREE.Group();
            
            // ëª¸í†µ (ì›í†µí˜•)
            const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1.5);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x4ecdc4 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 1;
            avatar.add(body);
            
            // ë¨¸ë¦¬ (êµ¬í˜•)
            const headGeometry = new THREE.SphereGeometry(0.4);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0x5fdbd6 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 2.2;
            avatar.add(head);
            
            // íŒ” (ì™¼ìª½)
            const armGeometry = new THREE.CylinderGeometry(0.1, 0.12, 1);
            const armMaterial = new THREE.MeshPhongMaterial({ color: 0x4ecdc4 });
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.5, 1, 0);
            leftArm.rotation.z = 0.2;
            avatar.add(leftArm);
            
            // íŒ” (ì˜¤ë¥¸ìª½)
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0.5, 1, 0);
            rightArm.rotation.z = -0.2;
            avatar.add(rightArm);
            
            // ë‹¤ë¦¬ (ì™¼ìª½)
            const legGeometry = new THREE.CylinderGeometry(0.12, 0.15, 1.2);
            const legMaterial = new THREE.MeshPhongMaterial({ color: 0x44a08d });
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(-0.2, 0.1, 0);
            avatar.add(leftLeg);
            
            // ë‹¤ë¦¬ (ì˜¤ë¥¸ìª½)
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0.2, 0.1, 0);
            avatar.add(rightLeg);
            
            // ë§ˆë²•ì˜ ì˜¤ë¼ íš¨ê³¼
            const auraGeometry = new THREE.RingGeometry(0.8, 1.2, 16);
            const auraMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x4ecdc4, 
                transparent: true, 
                opacity: 0.3,
                side: THREE.DoubleSide
            });
            const aura = new THREE.Mesh(auraGeometry, auraMaterial);
            aura.rotation.x = -Math.PI / 2;
            aura.position.y = 0.1;
            avatar.add(aura);
            
            // ì˜¤ë¼ íšŒì „ ì• ë‹ˆë©”ì´ì…˜
            gsap.to(aura.rotation, {
                z: Math.PI * 2,
                duration: 4,
                repeat: -1,
                ease: "none"
            });
            
            // ì•„ë°”íƒ€ ìœ„ì¹˜ ì„¤ì •
            avatar.position.set(0, 0, 0);
            scene.add(avatar);
            
            // ì¹´ë©”ë¼ë¥¼ ì•„ë°”íƒ€ ê·¼ì²˜ë¡œ ì´ë™
            if (camera && controls) {
                gsap.to(camera.position, {
                    x: 5, y: 5, z: 10,
                    duration: 1.5,
                    ease: "power2.out"
                });
                gsap.to(controls.target, {
                    x: 0, y: 1, z: 0,
                    duration: 1.5,
                    ease: "power2.out",
                    onUpdate: () => controls.update()
                });
            }
            
            updateStatus('ğŸš¶â€â™€ï¸ ìˆ² ì† ì•„ë°”íƒ€ê°€ ì†Œí™˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ğŸš¶â€â™€ï¸ ì•„ë°”íƒ€ ì œê±°
        function removeAvatar() {
            if (avatar) {
                // ì•„ë°”íƒ€ ê·¸ë£¹ì˜ ëª¨ë“  ìì‹ ìš”ì†Œë“¤ì„ ì œê±°
                while(avatar.children.length > 0) {
                    const child = avatar.children[0];
                    avatar.remove(child);
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) child.material.dispose();
                }
                // ì”¬ì—ì„œ ì•„ë°”íƒ€ ê·¸ë£¹ ì œê±°
                scene.remove(avatar);
                avatar = null;
                updateStatus('ğŸ‘‹ ì•„ë°”íƒ€ê°€ ìˆ² ì†ìœ¼ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤');
            }
        }
        
        // ğŸ“· ì¹´ë©”ë¼ ë¦¬ì…‹
        function resetCamera() {
            if (camera && controls) {
                gsap.to(camera.position, {
                    x: 0, y: 10, z: 20,
                    duration: 1.5,
                    ease: "power2.out"
                });
                gsap.to(controls.target, {
                    x: 0, y: 0, z: 0,
                    duration: 1.5,
                    ease: "power2.out",
                    onUpdate: () => controls.update()
                });
                updateStatus('ğŸ“· ì¹´ë©”ë¼ê°€ ìˆ²ì˜ ì¤‘ì‹¬ìœ¼ë¡œ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ğŸŒ§ï¸ ë‚ ì”¨ ë³€ê²½
        function toggleWeather() {
            const weathers = ['â˜€ï¸ ë§‘ìŒ', 'ğŸŒ§ï¸ ë¹„', 'ğŸŒ«ï¸ ì•ˆê°œ', 'â„ï¸ ëˆˆ'];
            const randomWeather = weathers[Math.floor(Math.random() * weathers.length)];
            updateStatus(`ğŸŒ² ìˆ²ì˜ ë‚ ì”¨ê°€ ${randomWeather}ë¡œ ë³€í–ˆìŠµë‹ˆë‹¤`);
        }
        
        // ğŸ·ï¸ ìˆ² ë„ê¹¨ë¹„ ì´ë¦„í‘œ ìƒì„±
        function createForestGoblinNameTag(name, specialty) {
            // ìº”ë²„ìŠ¤ ìƒì„±
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 256;
            
            // ë°°ê²½ ê·¸ë¦¬ê¸°
            context.fillStyle = 'rgba(46, 90, 53, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // í…Œë‘ë¦¬ ê·¸ë¦¬ê¸°
            context.strokeStyle = '#4ecdc4';
            context.lineWidth = 8;
            context.strokeRect(4, 4, canvas.width - 8, canvas.height - 8);
            
            // ì´ë¦„ í…ìŠ¤íŠ¸
            context.fillStyle = '#4ecdc4';
            context.font = 'bold 48px Arial';
            context.textAlign = 'center';
            context.fillText(name, canvas.width / 2, 80);
            
            // ì „ë¬¸ ë¶„ì•¼ í…ìŠ¤íŠ¸
            context.fillStyle = '#a8e6cf';
            context.font = '32px Arial';
            context.fillText(specialty, canvas.width / 2, 140);
            
            // ì¥ì‹ ë¼ì¸
            context.strokeStyle = '#4ecdc4';
            context.lineWidth = 2;
            context.beginPath();
            context.moveTo(50, 160);
            context.lineTo(canvas.width - 50, 160);
            context.stroke();
            
            // ì‘ì€ ë³„ ì¥ì‹ë“¤
            context.fillStyle = '#7fdfdb';
            for (let i = 0; i < 5; i++) {
                const x = 80 + i * 90;
                const y = 200;
                context.beginPath();
                context.arc(x, y, 8, 0, Math.PI * 2);
                context.fill();
            }
            
            // í…ìŠ¤ì²˜ ìƒì„±
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            
            // í‰ë©´ ì§€ì˜¤ë©”íŠ¸ë¦¬ì™€ ë¨¸í‹°ë¦¬ì–¼
            const planeGeometry = new THREE.PlaneGeometry(4, 2);
            const planeMaterial = new THREE.MeshBasicMaterial({ 
                map: texture, 
                transparent: true,
                side: THREE.DoubleSide
            });
            
            const nameTagMesh = new THREE.Mesh(planeGeometry, planeMaterial);
            
            // ì´ë¦„í‘œ ì‹ë³„ì„ ìœ„í•œ userData ì„¤ì •
            nameTagMesh.userData.isNameTag = true;
            
            return nameTagMesh;
        }
        
        // ğŸ§šâ€â™€ï¸ 3D ìˆ² ë„ê¹¨ë¹„ë“¤ ìƒì„±
        function createForest3DGoblins() {
            forestGoblins.forEach((goblin, index) => {
                const goblin3D = createForest3DGoblin(goblin, index);
                scene.add(goblin3D);
            });
        }
        
        // ğŸ§šâ€â™€ï¸ ê°œë³„ 3D ìˆ² ë„ê¹¨ë¹„ ìƒì„±
        function createForest3DGoblin(goblinData, index) {
            const goblinGroup = new THREE.Group();
            
            // ë„ê¹¨ë¹„ ëª¸ì²´ (êµ¬í˜•)
            const bodyGeometry = new THREE.SphereGeometry(1);
            const bodyMaterial = new THREE.MeshPhongMaterial({ 
                color: goblinData.color,
                shininess: 100
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 1;
            goblinGroup.add(body);
            
            // ë„ê¹¨ë¹„ ëˆˆ (ì™¼ìª½)
            const eyeGeometry = new THREE.SphereGeometry(0.15);
            const eyeMaterial = new THREE.MeshBasicMaterial({ color: 0xFFFFFF });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.3, 1.3, 0.7);
            goblinGroup.add(leftEye);
            
            // ë„ê¹¨ë¹„ ëˆˆ (ì˜¤ë¥¸ìª½)
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.3, 1.3, 0.7);
            goblinGroup.add(rightEye);
            
            // ë„ê¹¨ë¹„ ëˆˆë™ì (ì™¼ìª½)
            const pupilGeometry = new THREE.SphereGeometry(0.08);
            const pupilMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const leftPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            leftPupil.position.set(-0.3, 1.3, 0.75);
            goblinGroup.add(leftPupil);
            
            // ë„ê¹¨ë¹„ ëˆˆë™ì (ì˜¤ë¥¸ìª½)
            const rightPupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            rightPupil.position.set(0.3, 1.3, 0.75);
            goblinGroup.add(rightPupil);
            
            // ë„ê¹¨ë¹„ ëª¨ì (ì›ë¿”í˜•)
            const hatGeometry = new THREE.ConeGeometry(0.8, 1.5);
            const hatMaterial = new THREE.MeshPhongMaterial({ 
                color: goblinData.color,
                transparent: true,
                opacity: 0.8
            });
            const hat = new THREE.Mesh(hatGeometry, hatMaterial);
            hat.position.y = 2.5;
            goblinGroup.add(hat);
            
            // ë§ˆë²• ì˜¤ë¼ (ë„ê¹¨ë¹„ë³„ íŠ¹ë³„í•œ ìƒ‰ìƒ)
            const auraGeometry = new THREE.RingGeometry(1.5, 2, 16);
            const auraMaterial = new THREE.MeshBasicMaterial({ 
                color: goblinData.color,
                transparent: true,
                opacity: 0.2,
                side: THREE.DoubleSide
            });
            const aura = new THREE.Mesh(auraGeometry, auraMaterial);
            aura.rotation.x = -Math.PI / 2;
            aura.position.y = 0.1;
            goblinGroup.add(aura);
            
            // ğŸ·ï¸ ë„ê¹¨ë¹„ ì´ë¦„í‘œ ìƒì„±
            const nameTag = createForestGoblinNameTag(goblinData.name, goblinData.specialty);
            nameTag.position.set(0, 4, 0);
            goblinGroup.add(nameTag);
            
            // ìœ„ì¹˜ ì„¤ì • (ì›í˜•ìœ¼ë¡œ ë°°ì¹˜)
            const angle = (index / forestGoblins.length) * Math.PI * 2;
            const radius = 15;
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            goblinGroup.position.set(x, 0, z);
            
            // ì¤‘ì‹¬ì„ ë°”ë¼ë³´ë„ë¡ íšŒì „
            goblinGroup.lookAt(0, 1, 0);
            
            // ë„ê¹¨ë¹„ ë°ì´í„° ì €ì¥
            goblinGroup.userData = {
                goblinData: goblinData,
                index: index,
                isForestGoblin: true
            };
            
            // ë¶€ë“œëŸ¬ìš´ ë– ì˜¤ë¥´ëŠ” ì• ë‹ˆë©”ì´ì…˜
            gsap.to(goblinGroup.position, {
                y: Math.sin(index) * 0.5,
                duration: 3 + index * 0.5,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
            
            // ì˜¤ë¼ íšŒì „ ì• ë‹ˆë©”ì´ì…˜
            gsap.to(aura.rotation, {
                z: Math.PI * 2,
                duration: 4 + index,
                repeat: -1,
                ease: "none"
            });
            
            // ëª¨ì ì‚´ì§ í”ë“¤ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜
            gsap.to(hat.rotation, {
                z: Math.sin(index) * 0.1,
                duration: 2 + index * 0.3,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
            
            return goblinGroup;
        }
        
        // ğŸ§šâ€â™€ï¸ ìˆ² ë„ê¹¨ë¹„ í´ë¦­ ì²˜ë¦¬ (3D)
        function onForestCanvasClick(event) {
            if (!camera || !scene) return;
            
            // ë§ˆìš°ìŠ¤ ì¢Œí‘œë¥¼ ì •ê·œí™”ëœ ë””ë°”ì´ìŠ¤ ì¢Œí‘œë¡œ ë³€í™˜
            const rect = renderer.domElement.getBoundingClientRect();
            const mouse = new THREE.Vector2();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            // ë ˆì´ìºìŠ¤í„° ì„¤ì •
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            
            // ëª¨ë“  ì˜¤ë¸Œì íŠ¸ì™€ì˜ êµì°¨ì  ì°¾ê¸°
            const intersects = raycaster.intersectObjects(scene.children, true);
            
            if (intersects.length > 0) {
                // í´ë¦­ëœ ì˜¤ë¸Œì íŠ¸ ì°¾ê¸°
                let clickedObject = intersects[0].object;
                
                // ë¶€ëª¨ ê·¸ë£¹ ì°¾ê¸°
                while (clickedObject && !clickedObject.userData.isForestGoblin) {
                    clickedObject = clickedObject.parent;
                }
                
                if (clickedObject && clickedObject.userData.isForestGoblin) {
                    const goblinData = clickedObject.userData.goblinData;
                    selectForestGoblin(goblinData);
                    
                    // í´ë¦­ íš¨ê³¼
                    gsap.to(clickedObject.scale, {
                        x: 1.2, y: 1.2, z: 1.2,
                        duration: 0.2,
                        yoyo: true,
                        repeat: 1,
                        ease: "power2.out"
                    });
                }
            }
        }
        
        // ğŸ§šâ€â™€ï¸ ìˆ² ë„ê¹¨ë¹„ ì¹´ë“œ ìƒì„±
        function createForestGoblinCards() {
            const gridElement = document.getElementById('forestGoblinGrid');
            
            forestGoblins.forEach((goblin, index) => {
                const card = document.createElement('div');
                card.className = 'forest-goblin-card';
                card.onclick = () => selectForestGoblin(goblin);
                
                card.innerHTML = `
                    <div class="goblin-name">${goblin.name}</div>
                    <div class="goblin-specialty">${goblin.specialty}</div>
                    <div style="font-size: 12px; color: #88c999;">${goblin.description}</div>
                `;
                
                gridElement.appendChild(card);
            });
        }
        
        // ğŸ§šâ€â™€ï¸ ìˆ² ë„ê¹¨ë¹„ ì„ íƒ
        function selectForestGoblin(goblin) {
            updateStatus(`âœ¨ ${goblin.name}ì™€ ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!`);
            console.log('ì„ íƒëœ ìˆ² ë„ê¹¨ë¹„:', goblin);
            
            // ì±„íŒ… ì°½ ì—´ê¸°
            openChat(goblin);
        }
        
        // ğŸ’¬ ì±„íŒ… ì‹œìŠ¤í…œ ê´€ë ¨ ë³€ìˆ˜
        let currentChatGoblin = null;
        let chatHistory = [];
        
        // ğŸ’¬ ì±„íŒ… ì°½ ì—´ê¸°
        function openChat(goblin) {
            currentChatGoblin = goblin;
            const chatContainer = document.getElementById('chatContainer');
            const chatTitle = document.getElementById('chatTitle');
            const chatMessages = document.getElementById('chatMessages');
            
            chatTitle.textContent = `${goblin.emoji} ${goblin.name}ì™€ ëŒ€í™”`;
            chatContainer.style.display = 'flex';
            
            // í™˜ì˜ ë©”ì‹œì§€ ì¶”ê°€
            addChatMessage('ai', `ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ${goblin.name}ì…ë‹ˆë‹¤. ${goblin.description} ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`);
            
            // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
            document.getElementById('chatInput').focus();
        }
        
        // ğŸ’¬ ì±„íŒ… ì°½ ë‹«ê¸°
        function closeChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.style.display = 'none';
            currentChatGoblin = null;
            
            // ì±„íŒ… ê¸°ë¡ ì´ˆê¸°í™”
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            chatHistory = [];
        }
        
        // ğŸ’¬ ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€
        function addChatMessage(type, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}-message`;
            messageDiv.textContent = message;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // ì±„íŒ… ê¸°ë¡ì— ì¶”ê°€
            chatHistory.push({ type, message, timestamp: new Date() });
        }
        
        // ğŸ’¬ ì±„íŒ… ì…ë ¥ ì²˜ë¦¬
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message && currentChatGoblin) {
                    // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
                    addChatMessage('user', message);
                    input.value = '';
                    
                    // AI ì‘ë‹µ ìƒì„± (ì‹œë®¬ë ˆì´ì…˜)
                    setTimeout(() => {
                        const aiResponse = generateForestGoblinResponse(message, currentChatGoblin);
                        addChatMessage('ai', aiResponse);
                    }, 1000);
                }
            }
        }
        
        // ğŸ¤– ìˆ² ë„ê¹¨ë¹„ AI ì‘ë‹µ ìƒì„±
        function generateForestGoblinResponse(userMessage, goblin) {
            const lowerMessage = userMessage.toLowerCase();
            
            // ë„ê¹¨ë¹„ë³„ íŠ¹í™” ì‘ë‹µ
            switch (goblin.name) {
                case 'ğŸŒ¿ ìˆ²ì§€ê¸°':
                    if (lowerMessage.includes('ë‚˜ë¬´') || lowerMessage.includes('ì‹ë¬¼')) {
                        return "ìˆ²ì˜ ë‚˜ë¬´ë“¤ì€ ê°ê° ê³ ìœ í•œ ìƒëª…ë ¥ì„ ê°€ì§€ê³  ìˆì–´ìš”. ì–´ë–¤ ë‚˜ë¬´ì— ëŒ€í•´ ì•Œê³  ì‹¶ìœ¼ì‹ ê°€ìš”?";
                    } else if (lowerMessage.includes('ë§ˆë²•')) {
                        return "ìì—° ë§ˆë²•ì€ ëª¨ë“  ìƒëª…ì²´ì™€ì˜ ì¡°í™”ì—ì„œ ë‚˜ì™€ìš”. ë‚˜ë¬´, í’€, ë°”ëŒê³¼ ëŒ€í™”í•´ë³´ì„¸ìš”.";
                    } else {
                        return "ìˆ²ì˜ ì§€í˜œë¥¼ ì°¾ê³  ê³„ì‹œëŠ”êµ°ìš”. ìì—°ì€ ëª¨ë“  ë‹µì„ ì•Œê³  ìˆë‹µë‹ˆë‹¤.";
                    }
                    
                case 'ğŸ¦‹ ë‚˜ë¹„ìˆ ì‚¬':
                    if (lowerMessage.includes('ë³€í™”') || lowerMessage.includes('ì„±ì¥')) {
                        return "ë³€í™”ëŠ” ìì—°ì˜ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ë§ˆë²•ì´ì—ìš”. ë‚˜ë¹„ê°€ ë˜ê¸° ìœ„í•´ ì• ë²Œë ˆëŠ” ëª¨ë“  ê²ƒì„ ë‚´ë ¤ë†“ì£ .";
                    } else if (lowerMessage.includes('ë‚˜ë¹„')) {
                        return "ë‚˜ë¹„ë“¤ì€ ë³€í™”ì˜ ë©”ì‹ ì €ì˜ˆìš”. ê°ê°ì˜ ë‚ ê°œ íŒ¨í„´ì€ ê³ ìœ í•œ ì´ì•¼ê¸°ë¥¼ ë‹´ê³  ìˆì–´ìš”.";
                    } else {
                        return "ì•„ë¦„ë‹¤ìš´ ë³€í™”ë¥¼ ì›í•˜ì‹ ë‹¤ë©´, ë¨¼ì € í˜„ì¬ì˜ ëª¨ìŠµì„ ì‚¬ë‘í•˜ëŠ” ê²ƒë¶€í„° ì‹œì‘í•˜ì„¸ìš”.";
                    }
                    
                case 'ğŸŒ™ ë‹¬ë¹›ë¬´ë‹¹':
                    if (lowerMessage.includes('ì¹˜ìœ ') || lowerMessage.includes('íšŒë³µ')) {
                        return "ë‹¬ë¹›ì€ ê°•ë ¥í•œ ì¹˜ìœ  ì—ë„ˆì§€ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”. ë§ˆìŒì˜ ìƒì²˜ë„ ì²œì²œíˆ ì•„ë¬¼ê²Œ í•´ì¤˜ìš”.";
                    } else if (lowerMessage.includes('ë‹¬') || lowerMessage.includes('ë°¤')) {
                        return "ë°¤í•˜ëŠ˜ì˜ ë‹¬ì€ ìš°ë¦¬ì˜ ê°ì •ê³¼ ê¹Šì´ ì—°ê²°ë˜ì–´ ìˆì–´ìš”. ë‹¬ì˜ ì£¼ê¸°ë¥¼ ê´€ì°°í•´ë³´ì„¸ìš”.";
                    } else {
                        return "ê³ ìš”í•œ ë°¤ì— ë‹¬ë¹›ì„ ë°›ìœ¼ë©° ëª…ìƒí•˜ë©´ ë‚´ë©´ì˜ í‰í™”ë¥¼ ì°¾ì„ ìˆ˜ ìˆì–´ìš”.";
                    }
                    
                case 'ğŸŒ¸ ê½ƒìˆ ì‚¬':
                    if (lowerMessage.includes('ê½ƒ') || lowerMessage.includes('í–¥ê¸°')) {
                        return "ê° ê½ƒì€ ê³ ìœ í•œ í–¥ê¸°ì™€ ì—ë„ˆì§€ë¥¼ ê°€ì ¸ìš”. ì–´ë–¤ ê½ƒì˜ ë§ˆë²•ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?";
                    } else if (lowerMessage.includes('ìƒ‰ê¹”') || lowerMessage.includes('ìƒ‰ìƒ')) {
                        return "ê½ƒì˜ ìƒ‰ê¹”ì€ ê°ê° ë‹¤ë¥¸ ê°ì •ê³¼ ì—ë„ˆì§€ë¥¼ ë‚˜íƒ€ë‚´ìš”. ë¹¨ê°•ì€ ì—´ì •, íŒŒë‘ì€ í‰ì˜¨ì´ì£ .";
                    } else {
                        return "ê½ƒë“¤ì˜ ì–¸ì–´ë¡œ ë§ˆìŒì„ ì „í•´ë³´ì„¸ìš”. ê½ƒì€ ë§ë³´ë‹¤ ë” ê¹Šì€ ê°ì •ì„ í‘œí˜„í•  ìˆ˜ ìˆì–´ìš”.";
                    }
                    
                case 'ğŸ¦Œ ì‚¬ìŠ´ì¹œêµ¬':
                    if (lowerMessage.includes('ë™ë¬¼') || lowerMessage.includes('ì‚¬ìŠ´')) {
                        return "ìˆ²ì˜ ë™ë¬¼ë“¤ì€ ìˆœìˆ˜í•œ ë§ˆìŒì„ ê°€ì§„ ì¡´ì¬ë“¤ì´ì—ìš”. ê·¸ë“¤ì—ê²Œì„œ ë§ì€ ê²ƒì„ ë°°ìš¸ ìˆ˜ ìˆì–´ìš”.";
                    } else if (lowerMessage.includes('ììœ ') || lowerMessage.includes('í‰í™”')) {
                        return "ì‚¬ìŠ´ë“¤ì²˜ëŸ¼ ììœ ë¡­ê³  í‰í™”ë¡œìš´ ë§ˆìŒì„ ê°€ì ¸ë³´ì„¸ìš”. ìì—° ì†ì—ì„œ ì§„ì •í•œ ììœ ë¥¼ ëŠë‚„ ìˆ˜ ìˆì–´ìš”.";
                    } else {
                        return "ë™ë¬¼ë“¤ì˜ ìˆœìˆ˜í•œ ë§ˆìŒì„ ë‹®ì•„ê°€ì„¸ìš”. ê·¸ë“¤ì€ í˜„ì¬ ìˆœê°„ì„ ì˜¨ì „íˆ ì‚´ì•„ê°€ëŠ” ë°©ë²•ì„ ì•Œê³  ìˆì–´ìš”.";
                    }
                    
                case 'âœ¨ ë°˜ë”§ë¶ˆìš”ì •':
                    if (lowerMessage.includes('ë¹›') || lowerMessage.includes('ë°˜ë”§ë¶ˆ')) {
                        return "ë°˜ë”§ë¶ˆì´ë“¤ì€ ì–´ë‘  ì†ì—ì„œë„ í¬ë§ì˜ ë¹›ì„ ë§Œë“¤ì–´ë‚´ìš”. ì‘ì€ ë¹›ë„ í° ë³€í™”ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.";
                    } else if (lowerMessage.includes('ì–´ë‘ ') || lowerMessage.includes('ë°¤')) {
                        return "ì–´ë‘ ì„ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”. ì–´ë‘ ì´ ìˆì–´ì•¼ ë¹›ì˜ ì†Œì¤‘í•¨ì„ ì•Œ ìˆ˜ ìˆì–´ìš”.";
                    } else {
                        return "ë‹¹ì‹ ë„ ëˆ„êµ°ê°€ì—ê²ŒëŠ” í¬ë§ì˜ ë¹›ì´ ë  ìˆ˜ ìˆì–´ìš”. ì‘ì€ ì¹œì ˆë„ í° ë¹›ì´ ë©ë‹ˆë‹¤.";
                    }
                    
                default:
                    return "ìˆ²ì˜ ì§€í˜œë¡œ ë§ì”€ë“œë¦¬ìë©´, ìì—°ê³¼ ì¡°í™”ë¥¼ ì´ë£¨ë©° ì‚´ì•„ê°€ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•´ìš”.";
            }
        }
        
        // ğŸŒ² ë§ˆë²•ì˜ ìˆ² í™˜ê²½ ìƒì„±
        function createMagicalForest() {
            // ğŸŒ³ ë‚˜ë¬´ë“¤ ìƒì„±
            for (let i = 0; i < 50; i++) {
                createMagicalTree();
            }
            
            // ğŸŒ¸ ë§ˆë²• ê½ƒë“¤
            for (let i = 0; i < 30; i++) {
                createMagicalFlower();
            }
            
            // ğŸ¦‹ ë°˜ë”§ë¶ˆì´ë“¤
            for (let i = 0; i < 20; i++) {
                createFirefly();
            }
            
            // ğŸŒ™ ë§ˆë²•ì˜ ë‹¬ë¹›
            createMoonlight();
        }
        
        // ğŸŒ³ ë§ˆë²• ë‚˜ë¬´ ìƒì„±
        function createMagicalTree() {
            const treeGroup = new THREE.Group();
            
            // ë‚˜ë¬´ ì¤„ê¸°
            const trunkGeometry = new THREE.CylinderGeometry(0.3, 0.5, 8);
            const trunkMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 4;
            treeGroup.add(trunk);
            
            // ë‚˜ë¬´ ìì‚¬ê·€ (ë§ˆë²•ì˜ ìƒ‰ìƒ)
            const leavesGeometry = new THREE.SphereGeometry(3);
            const magicalColors = [0x00ff88, 0x88ff00, 0x0088ff, 0xff8800];
            const leavesColor = magicalColors[Math.floor(Math.random() * magicalColors.length)];
            const leavesMaterial = new THREE.MeshPhongMaterial({ 
                color: leavesColor,
                transparent: true,
                opacity: 0.8
            });
            const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
            leaves.position.y = 8;
            treeGroup.add(leaves);
            
            // ëœë¤ ìœ„ì¹˜ ë°°ì¹˜
            const x = (Math.random() - 0.5) * 100;
            const z = (Math.random() - 0.5) * 100;
            treeGroup.position.set(x, 0, z);
            
            // ë¶€ë“œëŸ¬ìš´ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜
            gsap.to(treeGroup.rotation, {
                y: Math.random() * 0.1 - 0.05,
                duration: 3 + Math.random() * 2,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
            
            scene.add(treeGroup);
        }
        
        // ğŸŒ¸ ë§ˆë²• ê½ƒ ìƒì„±
        function createMagicalFlower() {
            const flowerGeometry = new THREE.ConeGeometry(0.5, 1, 6);
            const flowerColors = [0xff69b4, 0x9370db, 0x00ced1, 0xffa500];
            const flowerColor = flowerColors[Math.floor(Math.random() * flowerColors.length)];
            const flowerMaterial = new THREE.MeshPhongMaterial({ 
                color: flowerColor,
                emissive: flowerColor,
                emissiveIntensity: 0.2
            });
            const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
            
            const x = (Math.random() - 0.5) * 80;
            const z = (Math.random() - 0.5) * 80;
            flower.position.set(x, 0.5, z);
            
            // ë°˜ì§ì´ëŠ” ì• ë‹ˆë©”ì´ì…˜
            gsap.to(flower.material, {
                emissiveIntensity: 0.5,
                duration: 2 + Math.random(),
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
            
            scene.add(flower);
        }
        
        // ğŸ¦‹ ë°˜ë”§ë¶ˆì´ ìƒì„±
        function createFirefly() {
            const fireflyGeometry = new THREE.SphereGeometry(0.1);
            const fireflyMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xffff00,
                transparent: true,
                opacity: 0.8
            });
            const firefly = new THREE.Mesh(fireflyGeometry, fireflyMaterial);
            
            const x = (Math.random() - 0.5) * 60;
            const y = 2 + Math.random() * 8;
            const z = (Math.random() - 0.5) * 60;
            firefly.position.set(x, y, z);
            
            // ììœ ë¡­ê²Œ ë‚ ì•„ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜
            gsap.to(firefly.position, {
                x: x + (Math.random() - 0.5) * 20,
                y: y + (Math.random() - 0.5) * 5,
                z: z + (Math.random() - 0.5) * 20,
                duration: 5 + Math.random() * 5,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
            
            // ê¹œë¹¡ì´ëŠ” íš¨ê³¼
            gsap.to(firefly.material, {
                opacity: 0.2,
                duration: 1 + Math.random(),
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
            
            scene.add(firefly);
        }
        
        // ğŸŒ™ ë§ˆë²•ì˜ ë‹¬ë¹›
        function createMoonlight() {
            const moonLight = new THREE.DirectionalLight(0x9370db, 0.5);
            moonLight.position.set(10, 20, 10);
            moonLight.castShadow = true;
            scene.add(moonLight);
            
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
        }
        
        // ğŸŒ² ë§ˆë²•ì˜ ìˆ² ì´ˆê¸°í™”
        function initMagicalForest() {
            console.log('ğŸŒ² ë§ˆë²•ì˜ ìˆ² ì´ˆê¸°í™” ì‹œì‘...');
            
            // Scene ìƒì„±
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            // Camera ìƒì„±
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            
            // Renderer ìƒì„±
            const canvas = document.getElementById('forest-canvas');
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Controls ìƒì„±
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // ğŸŒ² ë§ˆë²•ì˜ ìˆ² í™˜ê²½ ìƒì„±
            createMagicalForest();
            
            // ğŸ§šâ€â™€ï¸ 3D ìˆ² ë„ê¹¨ë¹„ë“¤ ìƒì„±
            createForest3DGoblins();
            
            // ğŸ§šâ€â™€ï¸ ìˆ² ë„ê¹¨ë¹„ ì¹´ë“œ ìƒì„±
            createForestGoblinCards();
            
            // ğŸ–±ï¸ ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            canvas.addEventListener('click', onForestCanvasClick);
            
            // ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ
            isSystemReady = true;
            updateStatus('ğŸŒ² ë§ˆë²•ì˜ ìˆ²ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì‹ ë¹„ë¡œìš´ ëª¨í—˜ì„ ì‹œì‘í•˜ì„¸ìš”!');
            
            // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
            animate();
        }
        
        // ğŸ¬ ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);
            
            if (controls) {
                controls.update();
            }
            
            // ì•„ë°”íƒ€ê°€ ìˆì„ ë•Œ ì¹´ë©”ë¼ê°€ ì•„ë°”íƒ€ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ íšŒì „í•˜ë„ë¡
            if (avatar && controls) {
                controls.target.copy(avatar.position);
                controls.target.y += 1; // ì•„ë°”íƒ€ ì¤‘ì‹¬ ë†’ì´ë¡œ ì¡°ì •
            }
            
            // ğŸ·ï¸ ëª¨ë“  ì´ë¦„í‘œë“¤ì´ ì¹´ë©”ë¼ë¥¼ ë°”ë¼ë³´ë„ë¡ ì—…ë°ì´íŠ¸
            scene.traverse((object) => {
                if (object.userData && object.userData.isNameTag && camera) {
                    object.lookAt(camera.position);
                }
            });
            
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        // ğŸ“± ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });
        
        // ğŸš€ ë§ˆë²•ì˜ ìˆ² ì‹œì‘
        window.addEventListener('load', () => {
            initMagicalForest();
        });
    </script>
</body>
</html>
